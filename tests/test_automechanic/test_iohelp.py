""" test the automechanic.iohelp module
"""
from automechanic import iohelp


def test__find_abstraction():
    """ test iohelp.find_abstraction()
    """
    rid = 'OOC(C)C_m1.[O][O]_m3>>[O]OC(C)C_m2.O[O]_m2'
    q1h_mgeo = (('O', (1.160649880891, 0.0627978268174, -0.0408330725075)),
                ('O', (0.670030192617, -0.810012591664, 1.01847301649)),
                ('C', (-0.762764327328, -0.771623494653, 0.971879813498)),
                ('C', (-1.286027334011, 0.630975793141, 1.25724343361)),
                ('C', (-1.286025794377, -1.319989887595, -0.350244634965)),
                ('H', (2.10820223046, -0.0822581224768, 0.135216457591)),
                ('H', (-1.10626335348, -1.433832526376, 1.775585055636)),
                ('H', (-0.959411887323, 1.34277748802, 0.4919543629624)),
                ('H', (-2.37990142664, 0.642772565761, 1.288621209488)),
                ('H', (-0.902576311752, 0.995523287157, 2.215796882617)),
                ('H', (-0.9025737237, -2.330572084284, -0.524722174920)),
                ('H', (-2.379899853887, -1.353045699721, -0.3558229455)),
                ('H', (-0.959410238052, -0.70497322095, -1.195279213213)))
    q2_mgeo = (('O', (1.07394324121, 0.0501743774966, 0.0668114667428)),
               ('O', (2.355943241199, 0.0501743774966, 0.0668114667428)))
    q1_mgeo = (('O', (1.01849391329, 0.02212499683403, 0.0463288404118)),
               ('O', (2.424344519778, -0.02924375645281, 0.05658010669234)),
               ('C', (2.80314339128, -1.38272890920, 0.3266805371647)),
               ('C', (2.338504665743, -1.833731474576, 1.707956931019)),
               ('C', (2.338505036357, -2.329364870800, -0.775684415566)),
               ('H', (3.89891588452, -1.38511658503, 0.327157185309)),
               ('H', (1.246260227299, -1.860092545692, 1.776726361401)),
               ('H', (2.71835895531, -2.83374919094, 1.940450620285)),
               ('H', (2.690750920592, -1.13759031891, 2.476303244045)),
               ('H', (2.690751556464, -1.981462639680, -1.752379053941)),
               ('H', (2.7183593275, -3.34202255559, -0.606530163155)),
               ('H', (1.24626061603, -2.380102757813, -0.829068367911)))
    q2h_mgeo = (('O', (1.09332243633, -0.0516790137299, -0.01278085883290)),
                ('O', (0.596198306921, -1.092054935846, -0.810333075830)),
                ('H', (2.065302405982, -0.05663139196237, -0.016577352153)))

    mgeo_dct = {'OOC(C)C_m1': q1h_mgeo,
                '[O][O]_m3': q2_mgeo,
                '[O]OC(C)C_m2': q1_mgeo,
                'O[O]_m2': q2h_mgeo}
    dxyzs = iohelp.find_abstraction(rid, mgeo_dct)

    q1h_dxyz, q2_dxyz, q1_dxyz, q2h_dxyz = dxyzs

    assert q1h_dxyz == ('13\n\n'
                        '1 O 1.160649880891 0.0627978268174 -0.0408330725075\n'
                        '3 O 0.670030192617 -0.810012591664 1.01847301649\n'
                        'C -0.762764327328 -0.771623494653 0.971879813498\n'
                        'C -1.286027334011 0.630975793141 1.25724343361\n'
                        'C -1.286025794377 -1.319989887595 -0.350244634965\n'
                        '2 H 2.10820223046 -0.0822581224768 0.135216457591\n'
                        'H -1.10626335348 -1.433832526376 1.775585055636\n'
                        'H -0.959411887323 1.34277748802 0.4919543629624\n'
                        'H -2.37990142664 0.642772565761 1.288621209488\n'
                        'H -0.902576311752 0.995523287157 2.215796882617\n'
                        'H -0.9025737237 -2.330572084284 -0.52472217492\n'
                        'H -2.379899853887 -1.353045699721 -0.3558229455\n'
                        'H -0.959410238052 -0.70497322095 -1.195279213213\n')
    assert q2_dxyz == ('2\n\n'
                       'O 1.07394324121 0.0501743774966 0.0668114667428\n'
                       '4 O 2.355943241199 0.0501743774966 0.0668114667428\n')
    assert q1_dxyz == ('12\n\n'
                       'O 1.01849391329 0.02212499683403 0.0463288404118\n'
                       'O 2.424344519778 -0.02924375645281 0.05658010669234\n'
                       'C 2.80314339128 -1.3827289092 0.3266805371647\n'
                       'C 2.338504665743 -1.833731474576 1.707956931019\n'
                       'C 2.338505036357 -2.3293648708 -0.775684415566\n'
                       'H 3.89891588452 -1.38511658503 0.327157185309\n'
                       'H 1.246260227299 -1.860092545692 1.776726361401\n'
                       'H 2.71835895531 -2.83374919094 1.940450620285\n'
                       'H 2.690750920592 -1.13759031891 2.476303244045\n'
                       'H 2.690751556464 -1.98146263968 -1.752379053941\n'
                       'H 2.7183593275 -3.34202255559 -0.606530163155\n'
                       'H 1.24626061603 -2.380102757813 -0.829068367911\n')
    assert q2h_dxyz == ('3\n\n'
                        'O 1.09332243633 -0.0516790137299 -0.0127808588329\n'
                        'O 0.596198306921 -1.092054935846 -0.81033307583\n'
                        'H 2.065302405982 -0.05663139196237 -0.016577352153\n')


if __name__ == '__main__':
    test__find_abstraction()
